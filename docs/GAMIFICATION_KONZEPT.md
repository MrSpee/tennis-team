# ğŸ® Gamification-Konzept: "Schnell-Eingabe-Belohnung"

## ğŸ¯ Ziel
Spieler motivieren, Match-Ergebnisse **zeitnah** einzutragen, um:
- Aktuelle Daten fÃ¼r alle Spieler zu gewÃ¤hrleisten
- Team-Spirit und Engagement zu fÃ¶rdern
- Die App aktiv zu nutzen

---

## ğŸ“‹ **Wie funktioniert das System? (Einfache ErklÃ¤rung fÃ¼r Spieler)**

### **ğŸ¯ Das Grundprinzip:**
1. Du trÃ¤gst Match-Ergebnisse ein â†’ Du bekommst **Punkte**
2. Punkte bringen dir **Badges** und **PlÃ¤tze im Leaderboard**
3. Top-Performer bekommen **echte Preise** (TennisbÃ¤lle, GriffbÃ¤nder, etc.) ğŸ

---

### **â° Wann bekommst du Punkte?**

**Spielablauf:**
- Ein Spieltag startet zu einer bestimmten Zeit (z.B. 14:00 Uhr)
- **Zuerst** werden die **4 Einzel-Matches** gespielt (ca. 2 Stunden)
- **Danach** kommen die **2 Doppel-Matches** (ca. 1-2 Stunden)

**Punkte-Zeitfenster:**
- **Einzel-Matches (Match 1-4):** 
  - Erwartete Eingabe: **Spielstart + 2 Stunden**
  - Beispiel: Spielstart 14:00 Uhr â†’ Eingabe bis 16:00 Uhr fÃ¼r volle Punkte
  
- **Doppel-Matches (Match 5-6):**
  - Erwartete Eingabe: **Spielstart + 3-4 Stunden** (nach den Einzeln)
  - Beispiel: Spielstart 14:00 Uhr â†’ Eingabe bis 17:00-18:00 Uhr fÃ¼r volle Punkte

**Punkte-Verteilung (abgeschlossene Spiele):**
- âš¡ **Blitz (0-30 Min nach erwartetem Ende):** 50 Punkte
- ğŸš€ **Schnell (30-60 Min):** 30 Punkte
- âœ… **PÃ¼nktlich (60-120 Min):** 15 Punkte
- ğŸ“ **SpÃ¤t (120+ Min):** 5 Punkte

**Punkte fÃ¼r ZwischenstÃ¤nde (50% der vollen Punkte):**
- âš¡ **Blitz-Zwischenstand:** 25 Punkte (50% von 50)
- ğŸš€ **Schnell-Zwischenstand:** 15 Punkte (50% von 30)
- âœ… **PÃ¼nktlich-Zwischenstand:** 8 Punkte (50% von 15, gerundet)
- ğŸ“ **SpÃ¤t-Zwischenstand:** 3 Punkte (50% von 5, gerundet)

**Bei Abschluss des Spiels:**
- Wenn ein Spieler einen Zwischenstand eingetragen hat und das Spiel dann abschlieÃŸt:
  - Er erhÃ¤lt die **vollen Punkte** (100%) abzÃ¼glich der bereits erhaltenen Zwischenstand-Punkte
  - Beispiel: Zwischenstand (25 Punkte) + Abschluss (25 Punkte) = 50 Punkte gesamt

---

### **ğŸ† Was kannst du gewinnen?**

**Digitale Belohnungen:**
- ğŸ† **Badges** fÃ¼r dein Profil (Blitz-Eingabe, Streak-King, etc.)
- ğŸ¥‡ **PlÃ¤tze im Leaderboard** (Woche, Monat, Saison)
- â­ **Profil-Highlights** (Top-Performer werden hervorgehoben)

**Echte Preise (dank Sponsoren!):**
- ğŸ¾ **TennisbÃ¤lle** (3er Pack)
- ğŸ½ **GriffbÃ¤nder**
- ğŸ† **Saison-Champion:** Premium-Paket
- ğŸ‘¥ **Team-Preise:** Team-Abend fÃ¼r das beste Team

**Preisvergabe:**
- Monatlich: Top 3 bekommen Preise
- Saisonal: Top 10 bekommen Preise
- Spezial: LÃ¤ngster Streak, Meiste Blitz-Eingaben, etc.

---

### **ğŸ”’ Wer darf Ergebnisse eintragen?**

**Berechtigt sind:**
- âœ… **Teammitglieder des Heim-Teams** (du spielst im Heim-Team)
- âœ… **Teammitglieder des AuswÃ¤rts-Teams** (du spielst im AuswÃ¤rts-Team)
- âœ… **Spieler, die am Matchday teilnehmen** (du hast dich angemeldet)

**NICHT berechtigt:**
- âŒ Spieler anderer Teams (auch nicht vom gleichen Verein, aber anderer Kategorie)
- âŒ Spieler, die nicht am Matchday teilnehmen
- âŒ Externe Spieler ohne Team-Zuordnung

**Super-Admin:**
- âœ… Kann **alle** Ergebnisse verÃ¤ndern (fÃ¼r Korrekturen)
- âŒ Sammelt **KEINE** Punkte (nur regulÃ¤re Spieler bekommen Punkte)

**Warum?** Damit bleiben die Ergebnisse korrekt und fair! Nur wer wirklich dabei ist, kann eintragen. âœ…

---

## ğŸ† Belohnungssystem

### **1. Zeitbasierte Punkte (Speed Points)**

**Einzel-Matches (Match 1-4):**
- Erwartete Eingabezeit: **Spielstart + 2 Stunden** (Einzel werden zuerst gespielt)

**Abgeschlossene Spiele (100% Punkte):**
| Zeitfenster | Punkte | Badge |
|------------|--------|-------|
| **0-30 Minuten** nach erwartetem Ende | 50 Punkte | âš¡ Blitz-Eingabe |
| **30-60 Minuten** nach erwartetem Ende | 30 Punkte | ğŸš€ Schnell-Eingabe |
| **60-120 Minuten** nach erwartetem Ende | 15 Punkte | âœ… PÃ¼nktlich |
| **120+ Minuten** nach erwartetem Ende | 5 Punkte | ğŸ“ SpÃ¤t-Eingabe |

**ZwischenstÃ¤nde (50% Punkte):**
| Zeitfenster | Punkte | Hinweis |
|------------|--------|---------|
| **0-30 Minuten** nach erwartetem Ende | 25 Punkte | âš¡ Blitz-Zwischenstand |
| **30-60 Minuten** nach erwartetem Ende | 15 Punkte | ğŸš€ Schnell-Zwischenstand |
| **60-120 Minuten** nach erwartetem Ende | 8 Punkte | âœ… PÃ¼nktlich-Zwischenstand |
| **120+ Minuten** nach erwartetem Ende | 3 Punkte | ğŸ“ SpÃ¤t-Zwischenstand |

**Doppel-Matches (Match 5-6):**
- Erwartete Eingabezeit: **Spielstart + 3-4 Stunden** (Doppel kommen nach den Einzeln)

**Abgeschlossene Spiele (100% Punkte):**
| Zeitfenster | Punkte | Badge |
|------------|--------|-------|
| **0-30 Minuten** nach erwartetem Ende | 50 Punkte | âš¡ Blitz-Eingabe |
| **30-60 Minuten** nach erwartetem Ende | 30 Punkte | ğŸš€ Schnell-Eingabe |
| **60-120 Minuten** nach erwartetem Ende | 15 Punkte | âœ… PÃ¼nktlich |
| **120+ Minuten** nach erwartetem Ende | 5 Punkte | ğŸ“ SpÃ¤t-Eingabe |

**ZwischenstÃ¤nde (50% Punkte):**
| Zeitfenster | Punkte | Hinweis |
|------------|--------|---------|
| **0-30 Minuten** nach erwartetem Ende | 25 Punkte | âš¡ Blitz-Zwischenstand |
| **30-60 Minuten** nach erwartetem Ende | 15 Punkte | ğŸš€ Schnell-Zwischenstand |
| **60-120 Minuten** nach erwartetem Ende | 8 Punkte | âœ… PÃ¼nktlich-Zwischenstand |
| **120+ Minuten** nach erwartetem Ende | 3 Punkte | ğŸ“ SpÃ¤t-Zwischenstand |

**Berechnung:**
- `Spielstart` = `match_date` + `start_time`
- `Erwartetes Spielende (Einzel)` = `Spielstart` + 2 Stunden
- `Erwartetes Spielende (Doppel)` = `Spielstart` + 3.5 Stunden (Mitte zwischen 3-4h)
- `Eingabezeit` = `entered_at` (wann das Ergebnis gespeichert wurde)
- `Zeitdifferenz` = `Eingabezeit` - `Erwartetes Spielende`

**Wichtig:**
- âœ… **Abgeschlossene Spiele** geben volle Punkte (Status: `'completed'`, `'retired'`, `'walkover'`, etc.)
- âœ… **ZwischenstÃ¤nde** geben 50% der Punkte (Status: `'in_progress'`, `'pending'`)
- âœ… **Bei Abschluss** erhÃ¤lt der Spieler die vollen Punkte abzÃ¼glich der bereits erhaltenen Zwischenstand-Punkte
- âŒ **Ã„nderungen** an bereits abgeschlossenen Spielen geben KEINE Punkte
- âŒ **Super-Admin** sammelt KEINE Punkte (auch nicht bei neuen Eingaben)

### **2. Streak-System (Serien-Belohnung)**

**Wochen-Streak:**
- 3+ schnelle Eingaben in einer Woche â†’ +20 Bonus-Punkte
- 5+ schnelle Eingaben in einer Woche â†’ +50 Bonus-Punkte
- 7+ schnelle Eingaben in einer Woche â†’ +100 Bonus-Punkte + ğŸ… "Wochen-Champion" Badge

**Monats-Streak:**
- 10+ schnelle Eingaben im Monat â†’ +200 Bonus-Punkte
- 20+ schnelle Eingaben im Monat â†’ +500 Bonus-Punkte + ğŸ¥‡ "Monats-Champion" Badge

### **3. Team-Belohnungen**

**Team-Performance:**
- Wenn **alle 6 Ergebnisse** eines Matchdays innerhalb der erwarteten Zeit eingegeben werden:
  - Jeder Spieler, der ein Ergebnis eingetragen hat, erhÃ¤lt +25 Team-Bonus-Punkte
  - Team erhÃ¤lt ğŸ† "Team-Spirit" Badge

**Erste Eingabe:**
- Der erste Spieler, der ein Ergebnis eintrÃ¤gt â†’ +10 "Pionier"-Punkte

### **4. VollstÃ¤ndigkeits-Bonus**

**Komplette Eingabe:**
- Alle 6 Matches (4 Einzel + 2 Doppel) eingegeben â†’ +30 Bonus-Punkte
- Alle Spieler-Namen + Ergebnisse vollstÃ¤ndig â†’ +20 Bonus-Punkte

---

## ğŸ–ï¸ Badges & Achievements

### **Speed Badges:**
- âš¡ **Blitz-Eingabe** - 10x innerhalb von 30 Minuten nach erwartetem Ende
- ğŸš€ **Schnell-Eingabe** - 25x innerhalb von 60 Minuten nach erwartetem Ende
- âœ… **PÃ¼nktlich** - 50x innerhalb von 120 Minuten nach erwartetem Ende

### **Streak Badges:**
- ğŸ”¥ **Hot Streak** - 5 Tage in Folge schnelle Eingaben
- ğŸ’ª **Eisen-Wille** - 10 Tage in Folge
- ğŸ… **Wochen-Champion** - 7+ Eingaben in einer Woche
- ğŸ¥‡ **Monats-Champion** - 20+ Eingaben in einem Monat

### **Team Badges:**
- ğŸ† **Team-Spirit** - 3x alle Ergebnisse innerhalb 1 Stunde
- ğŸ‘¥ **Team-Player** - 10x Team-Bonus erhalten
- â­ **Team-Captain** - Meiste Team-Boni in der Saison

### **Spezial-Badges:**
- ğŸŒ™ **Nachteule** - Ergebnis nach 22 Uhr eingegeben
- â˜€ï¸ **FrÃ¼haufsteher** - Ergebnis vor 8 Uhr eingegeben
- ğŸ“± **Mobile Master** - 50x Ã¼ber Mobile eingegeben

---

## ğŸ“Š Leaderboard

### **WÃ¶chentliches Ranking:**
1. **Speed-Punkte** (Gesamtpunkte der Woche)
2. **Streak-LÃ¤nge** (Tage in Folge)
3. **Team-Boni** (Team-Punkte)

### **Monatliches Ranking:**
1. **Gesamtpunkte** des Monats
2. **Durchschnittliche Eingabezeit** (niedriger = besser)
3. **VollstÃ¤ndigkeits-Rate** (wie viele Matchdays komplett)

### **Saison-Ranking:**
1. **Gesamtpunkte** der Saison
2. **Badge-Sammlung** (Anzahl verschiedener Badges)
3. **Team-Contribution** (Beitrag zum Team)

---

## ğŸ’¡ UI-Features

### **1. Live-Feedback beim Speichern:**
```
âœ… Ergebnis gespeichert!
âš¡ Blitz-Eingabe! +50 Punkte
ğŸ”¥ 3 Tage Streak! +20 Bonus-Punkte
```

### **2. Progress-Bar:**
- Zeigt an, wie viele Punkte bis zum nÃ¤chsten Badge fehlen
- "Noch 3 schnelle Eingaben bis zum âš¡ Blitz-Badge!"

### **3. Leaderboard-Widget:**
- Zeigt Top 5 Spieler der Woche
- "Du bist auf Platz 3! ğŸ¥‰"

### **4. Badge-Showcase:**
- Profil-Seite zeigt alle gesammelten Badges
- Badge-Animation beim Erhalt

### **5. Team-Dashboard:**
- Zeigt Team-Performance
- "Euer Team hat diese Woche 5x Team-Bonus erhalten! ğŸ†"

---

## ğŸ”’ **Sicherheit & Berechtigung**

### **Wer darf Ergebnisse eintragen?**

**Berechtigte Spieler:**
1. âœ… **Teammitglieder des Heim-Teams** (aktive `team_memberships` fÃ¼r `home_team_id`)
2. âœ… **Teammitglieder des AuswÃ¤rts-Teams** (aktive `team_memberships` fÃ¼r `away_team_id`)
3. âœ… **Spieler, die am Matchday teilnehmen** (in `match_availability` als 'available' oder 'confirmed')
4. âœ… **Super-Admin** (fÃ¼r alle Matchdays, kann verÃ¤ndern, sammelt aber KEINE Punkte)

**NICHT berechtigt:**
- âŒ Spieler anderer Teams (auch nicht vom gleichen Verein, aber anderer Kategorie)
- âŒ Spieler, die nicht am Matchday teilnehmen
- âŒ Externe Spieler ohne Team-Zuordnung

**Validierung beim Speichern:**
- PrÃ¼fe, ob `entered_by` (User-ID) einem berechtigten Spieler gehÃ¶rt
- PrÃ¼fe Team-ZugehÃ¶rigkeit Ã¼ber `team_memberships` (sowohl Home als auch Away)
- PrÃ¼fe Matchday-Teilnahme Ã¼ber `match_availability`
- Bei Fehler: Warnung anzeigen, Eingabe verweigern

**ZwischenstÃ¤nde:**
- âœ… Spieler kÃ¶nnen **ZwischenstÃ¤nde** eintragen (wenn Spiel noch nicht beendet)
- âœ… FÃ¼r ZwischenstÃ¤nde gibt es **50% der Punkte** (z.B. 25 Punkte statt 50)
- âœ… Status muss `'in_progress'` oder `'pending'` sein fÃ¼r ZwischenstÃ¤nde
- âœ… **Bei Abschluss:** Spieler erhÃ¤lt volle Punkte abzÃ¼glich der bereits erhaltenen Zwischenstand-Punkte
- âœ… Beispiel: Zwischenstand (25 Punkte) + Abschluss (25 Punkte) = 50 Punkte gesamt

**Ã„nderungen an abgeschlossenen Spielen:**
- âš ï¸ **Warnung:** Wenn ein Spieler ein bereits abgeschlossenes Spiel Ã¤ndern will, wird er gewarnt:
  - "âš ï¸ Dieses Spiel ist bereits abgeschlossen. Die vorhandenen Daten werden Ã¼berschrieben. Bist du sicher?"
- âœ… **Audit-Trail:** Alle Ã„nderungen werden im System hinterlegt:
  - `match_result_history` Tabelle speichert alte Werte
  - `changed_by`, `changed_at`, `previous_values` werden gespeichert
- âŒ **Keine Punkte:** FÃ¼r Ã„nderungen an abgeschlossenen Spielen gibt es KEINE Punkte
- ğŸ›¡ï¸ **Schutz:** Verhindert, dass Spieler wahllos Ergebnisse Ã¤ndern um Punkte zu sammeln oder falsch einzugeben

---

## ğŸ”§ Technische Umsetzung

### **Datenbank-Erweiterungen:**

```sql
-- Neue Tabelle fÃ¼r Gamification-Punkte
CREATE TABLE player_achievements (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  player_id UUID REFERENCES players_unified(id),
  achievement_type VARCHAR(50), -- 'speed_entry', 'streak', 'team_bonus', etc.
  points INTEGER,
  badge_name VARCHAR(50),
  matchday_id UUID REFERENCES matchdays(id),
  match_result_id UUID REFERENCES match_results(id),
  match_type VARCHAR(20), -- 'Einzel' oder 'Doppel'
  time_to_entry_minutes INTEGER, -- Minuten bis zur Eingabe
  expected_end_time TIMESTAMP WITH TIME ZONE, -- Erwartetes Spielende
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Erweitere players_unified
ALTER TABLE players_unified ADD COLUMN IF NOT EXISTS gamification_points INTEGER DEFAULT 0;
ALTER TABLE players_unified ADD COLUMN IF NOT EXISTS current_streak INTEGER DEFAULT 0;
ALTER TABLE players_unified ADD COLUMN IF NOT EXISTS longest_streak INTEGER DEFAULT 0;
ALTER TABLE players_unified ADD COLUMN IF NOT EXISTS badges JSONB DEFAULT '[]'::jsonb;
ALTER TABLE players_unified ADD COLUMN IF NOT EXISTS last_entry_date DATE;

-- Erweitere match_results fÃ¼r Berechtigungs-Tracking und Punkte-Tracking
ALTER TABLE match_results ADD COLUMN IF NOT EXISTS entered_by UUID REFERENCES auth.users(id);
ALTER TABLE match_results ADD COLUMN IF NOT EXISTS entry_authorized BOOLEAN DEFAULT true; -- Wurde Berechtigung geprÃ¼ft?
ALTER TABLE match_results ADD COLUMN IF NOT EXISTS gamification_points INTEGER DEFAULT 0; -- Gespeicherte Punkte fÃ¼r dieses Match (fÃ¼r Zwischenstand-Abschluss-Berechnung)

-- Neue Tabelle fÃ¼r Audit-Trail (Ã„nderungen an abgeschlossenen Spielen)
CREATE TABLE match_result_history (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  match_result_id UUID REFERENCES match_results(id) ON DELETE CASCADE,
  changed_by UUID REFERENCES auth.users(id),
  changed_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  previous_values JSONB, -- Alte Werte vor der Ã„nderung
  new_values JSONB, -- Neue Werte nach der Ã„nderung
  reason TEXT -- Optional: Grund fÃ¼r die Ã„nderung
);

CREATE INDEX idx_match_result_history_match_result_id ON match_result_history(match_result_id);
CREATE INDEX idx_match_result_history_changed_by ON match_result_history(changed_by);
CREATE INDEX idx_match_result_history_changed_at ON match_result_history(changed_at);
```

### **Berechnungs-Logik:**

```javascript
// 1. PrÃ¼fe Berechtigung (Home UND Away Spieler)
const isAuthorized = await checkEntryAuthorization(userId, matchdayId, homeTeamId, awayTeamId);
if (!isAuthorized) {
  throw new Error('Du bist nicht berechtigt, Ergebnisse fÃ¼r diesen Matchday einzutragen.');
}

// 2. PrÃ¼fe ob Super-Admin (sammelt keine Punkte)
const { data: playerData } = await supabase
  .from('players_unified')
  .select('id, is_super_admin')
  .eq('user_id', userId)
  .single();
const isSuperAdmin = playerData?.is_super_admin === true;

// 3. PrÃ¼fe ob bereits abgeschlossenes Spiel geÃ¤ndert wird
const existingResult = await getExistingResult(matchResultId);
const isCompleted = existingResult && ['completed', 'retired', 'walkover', 'disqualified', 'defaulted'].includes(existingResult.status);
const isUpdate = existingResult !== null;

if (isUpdate && isCompleted) {
  // Warnung anzeigen (UI)
  const confirmed = await showWarningDialog(
    'âš ï¸ Dieses Spiel ist bereits abgeschlossen.',
    'Die vorhandenen Daten werden Ã¼berschrieben. Bist du sicher?'
  );
  if (!confirmed) {
    throw new Error('Eingabe abgebrochen.');
  }
  
  // Audit-Trail: Speichere alte Werte
  await saveMatchResultHistory({
    match_result_id: matchResultId,
    changed_by: userId,
    changed_at: new Date(),
    previous_values: existingResult,
    new_values: newResultData
  });
  
  // KEINE Punkte fÃ¼r Ã„nderungen
  points = 0;
} else {
  // 4. PrÃ¼fe ob Zwischenstand (50% der Punkte)
  const isInProgress = newResultData.status === 'in_progress' || newResultData.status === 'pending';
  const isCompleted = ['completed', 'retired', 'walkover', 'disqualified', 'defaulted'].includes(newResultData.status);
  
  // PrÃ¼fe ob bereits ein Zwischenstand fÃ¼r dieses Match eingetragen wurde
  const existingProgressEntry = existingResult && (existingResult.status === 'in_progress' || existingResult.status === 'pending');
  const wasProgressEntry = existingProgressEntry && isCompleted; // Zwischenstand wird jetzt abgeschlossen
  
  if (isSuperAdmin) {
    // Super-Admin: KEINE Punkte
    points = 0;
  } else {
    // 5. Berechne erwartetes Spielende basierend auf Match-Typ
    const matchStart = new Date(matchday.match_date + 'T' + matchday.start_time);
    let expectedEndTime;

    if (matchType === 'Einzel') {
      // Einzel: Spielstart + 2 Stunden
      expectedEndTime = new Date(matchStart.getTime() + 2 * 60 * 60 * 1000);
    } else if (matchType === 'Doppel') {
      // Doppel: Spielstart + 3.5 Stunden (nach den Einzeln)
      expectedEndTime = new Date(matchStart.getTime() + 3.5 * 60 * 60 * 1000);
    }

    // 6. Berechne Zeitdifferenz
    const enteredAt = new Date();
    const timeDiffMinutes = (enteredAt - expectedEndTime) / (1000 * 60);

    // 7. Bestimme Punkte basierend auf Zeitfenster
    let basePoints = 0;
    if (timeDiffMinutes <= 30) basePoints = 50;      // Blitz
    else if (timeDiffMinutes <= 60) basePoints = 30;  // Schnell
    else if (timeDiffMinutes <= 120) basePoints = 15; // PÃ¼nktlich
    else basePoints = 5;                               // SpÃ¤t

    // 8. PrÃ¼fe ob Zwischenstand oder Abschluss
    if (isInProgress) {
      // Zwischenstand: 50% der Punkte
      points = Math.round(basePoints * 0.5);
    } else if (wasProgressEntry) {
      // Abschluss nach Zwischenstand: Volle Punkte abzÃ¼glich bereits erhaltener Zwischenstand-Punkte
      const previousProgressPoints = existingResult.gamification_points || 0; // Zwischenstand-Punkte
      points = basePoints - previousProgressPoints; // Differenz zu vollen Punkten
    } else {
      // Direkter Abschluss: Volle Punkte
      points = basePoints;
    }

    // 9. PrÃ¼fe Streak
    const streakBonus = calculateStreakBonus(playerId, enteredAt);

    // 10. PrÃ¼fe Team-Bonus
    const teamBonus = await checkTeamBonus(matchdayId, enteredAt);

    // 11. Speichere Achievement
    await saveAchievement(playerId, {
      type: isInProgress ? 'progress_entry' : 'speed_entry',
      points: points + streakBonus + teamBonus,
      timeToEntry: timeDiffMinutes,
      matchType: matchType,
      expectedEndTime: expectedEndTime,
      isProgressEntry: isInProgress,
      badge: getBadgeForTime(timeDiffMinutes)
    });
  }
}

// 11. Speichere Ergebnis
await saveMatchResult(newResultData, userId);
```

### **Berechtigungs-PrÃ¼fung:**

```javascript
async function checkEntryAuthorization(userId, matchdayId, homeTeamId, awayTeamId) {
  // 1. Hole Spieler-ID des Users
  const { data: player } = await supabase
    .from('players_unified')
    .select('id, is_super_admin')
    .eq('user_id', userId)
    .single();
  
  if (!player) return false;
  
  // 2. PrÃ¼fe Super-Admin (kann alle Ergebnisse verÃ¤ndern)
  if (player.is_super_admin === true) return true;
  
  // 3. PrÃ¼fe Team-Membership (Home-Team)
  const { data: homeMembership } = await supabase
    .from('team_memberships')
    .select('id')
    .eq('player_id', player.id)
    .eq('team_id', homeTeamId)
    .eq('is_active', true)
    .maybeSingle();
  
  if (homeMembership) return true;
  
  // 4. PrÃ¼fe Team-Membership (Away-Team)
  const { data: awayMembership } = await supabase
    .from('team_memberships')
    .select('id')
    .eq('player_id', player.id)
    .eq('team_id', awayTeamId)
    .eq('is_active', true)
    .maybeSingle();
  
  if (awayMembership) return true;
  
  // 5. PrÃ¼fe Matchday-Teilnahme
  const { data: availability } = await supabase
    .from('match_availability')
    .select('id')
    .eq('matchday_id', matchdayId)
    .eq('player_id', player.id)
    .in('status', ['available', 'confirmed'])
    .maybeSingle();
  
  return availability !== null;
}
```

---

## ğŸ¨ UI-Design-VorschlÃ¤ge

### **Beim Speichern:**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âœ… Ergebnis gespeichert!           â”‚
â”‚                                     â”‚
â”‚  âš¡ Blitz-Eingabe!                  â”‚
â”‚  +50 Punkte                         â”‚
â”‚                                     â”‚
â”‚  ğŸ”¥ 3 Tage Streak!                  â”‚
â”‚  +20 Bonus-Punkte                   â”‚
â”‚                                     â”‚
â”‚  ğŸ† Team-Bonus!                     â”‚
â”‚  +25 Team-Punkte                    â”‚
â”‚                                     â”‚
â”‚  Gesamt: +95 Punkte                 â”‚
â”‚  Neuer Rang: #3 ğŸ¥‰                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **Badge-Animation:**
- Badge erscheint mit Animation
- Konfetti-Effekt bei besonderen Achievements
- Sound-Feedback (optional)

---

## ğŸ“ˆ Motivation & Psychologie

### **Warum funktioniert das?**

1. **Sofortige Belohnung:** Spieler sehen sofort Punkte/Badges
2. **Soziale Anerkennung:** Leaderboard zeigt Top-Performer
3. **Team-Spirit:** Gemeinsame Ziele fÃ¶rdern Zusammenarbeit
4. **Wettbewerb:** Gesunder Wettbewerb motiviert
5. **Fortschritt:** Sichtbare Fortschrittsbalken zeigen Entwicklung
6. **Echte Preise:** Konkrete Belohnungen fÃ¼r Engagement

### **Gamification-Prinzipien:**
- âœ… **Clear Goals:** Klare Ziele (2h fÃ¼r Einzel, 3-4h fÃ¼r Doppel)
- âœ… **Immediate Feedback:** Sofortige Punkte/Badges
- âœ… **Progress Tracking:** Sichtbare Fortschrittsanzeige
- âœ… **Social Proof:** Leaderboard & Team-Rankings
- âœ… **Achievement Unlocking:** Badges als Meilensteine
- âœ… **Tangible Rewards:** Echte Preise als Motivation

---

## ğŸš€ Phasenweise EinfÃ¼hrung

### **Phase 1: Basis-System (MVP)**
- Zeitbasierte Punkte (0-60 Minuten)
- Einfaches Leaderboard
- Basis-Badges

### **Phase 2: Erweiterte Features**
- Streak-System
- Team-Boni
- Erweiterte Badges

### **Phase 3: Social Features**
- Team-Dashboard
- Badge-Showcase
- Erweiterte Leaderboards

---

## ğŸ **Echte Preise fÃ¼r engagierte Spieler**

### **Digitale Belohnungen:**
- ğŸ† Exklusive Badges fÃ¼r dein Profil
- â­ Profil-Highlights (Top-Performer werden hervorgehoben)
- ğŸ¨ Custom Avatar-Frames

### **Echte Preise (dank unserer Sponsoren!):**

**Monatliche Preise:**
- ğŸ¥‡ **Platz 1:** TennisbÃ¤lle (3er Pack) + GriffbÃ¤nder
- ğŸ¥ˆ **Platz 2:** TennisbÃ¤lle (3er Pack)
- ğŸ¥‰ **Platz 3:** GriffbÃ¤nder

**Saisonale Preise:**
- ğŸ† **Saison-Champion:** Premium-TennisbÃ¤lle + GriffbÃ¤nder + Exklusives Badge
- ğŸ–ï¸ **Top 10:** TennisbÃ¤lle oder GriffbÃ¤nder

**Team-Preise:**
- ğŸ† **Bestes Team:** Team-Abend oder gemeinsame AktivitÃ¤t

**Spezial-Preise:**
- ğŸ”¥ **Streak-King:** LÃ¤ngster Streak â†’ Spezial-Preis
- âš¡ **Blitz-Meister:** Meiste Blitz-Eingaben â†’ Spezial-Preis

**Hinweis:** Preise werden durch Sponsoren finanziert. Wir suchen aktuell nach Partnern, die unser Engagement belohnen mÃ¶chten! ğŸ’ª

### **Wie werden Preise vergeben?**
- Monatliche Preise: Top 3 des Monats
- Saisonale Preise: Top 10 der Saison
- Team-Preise: Bestes Team pro Saison
- Spezial-Preise: Besondere Achievements

**Preisvergabe:**
- Preise werden am Ende jedes Monats/Saison vergeben
- Kontaktaufnahme Ã¼ber die App
- Abholung oder Versand (je nach Vereinbarung)

---

## ğŸ“Š Erfolgs-Metriken

### **KPIs:**
- Durchschnittliche Eingabezeit (Ziel: < 30 Minuten)
- Eingabe-Rate innerhalb 1 Stunde (Ziel: > 80%)
- Aktive Spieler im Gamification-System (Ziel: > 70%)
- Streak-Durchschnitt (Ziel: > 3 Tage)

---

## ğŸ“ **Zusammenfassung fÃ¼r Spieler**

### **So funktioniert's:**

1. **Spieltag startet** (z.B. 14:00 Uhr)
2. **Einzel werden gespielt** (ca. 2 Stunden)
3. **Doppel werden gespielt** (ca. 1-2 Stunden danach)
4. **Du trÃ¤gst Ergebnisse ein** â†’ Je schneller, desto mehr Punkte! âš¡
5. **Du sammelst Punkte** â†’ Badges, Leaderboard-PlÃ¤tze, echte Preise! ğŸ

### **Wichtig zu wissen:**

- âœ… **Nur Teammitglieder** (Home UND Away) kÃ¶nnen Ergebnisse eintragen
- âœ… **Einzel:** Eingabe bis 2h nach Start = volle Punkte
- âœ… **Doppel:** Eingabe bis 3-4h nach Start = volle Punkte
- âœ… **Schneller = mehr Punkte** (bis zu 50 Punkte pro Match!)
- âœ… **Streaks bringen Bonus-Punkte** (mehrere schnelle Eingaben hintereinander)
- âœ… **Team-Boni** wenn alle Ergebnisse schnell eingegeben werden
- âœ… **Echte Preise** fÃ¼r Top-Performer (TennisbÃ¤lle, GriffbÃ¤nder, etc.)
- âœ… **ZwischenstÃ¤nde** geben 50% der Punkte (z.B. 25 statt 50)
- âœ… **Bei Abschluss** erhÃ¤lt der Spieler die vollen Punkte abzÃ¼glich der bereits erhaltenen Zwischenstand-Punkte
- âš ï¸ **Ã„nderungen** an abgeschlossenen Spielen geben KEINE Punkte (mit Warnung)
- âš ï¸ **Super-Admin** sammelt KEINE Punkte (auch nicht bei neuen Eingaben)

### **Beispiel:**

**Spieltag:** Samstag, 14:00 Uhr Start

**Szenario 1: Direkter Abschluss**
- **15:30 Uhr:** Du trÃ¤gst ein Einzel-Ergebnis ein (1,5h nach Start, 30 Min vor erwartetem Ende)
  - â†’ âš¡ **Blitz-Eingabe!** +50 Punkte (abgeschlossen)
  
- **17:00 Uhr:** Du trÃ¤gst ein Doppel-Ergebnis ein (3h nach Start, pÃ¼nktlich)
  - â†’ âœ… **PÃ¼nktlich!** +15 Punkte (abgeschlossen)

- **Gesamt:** +65 Punkte fÃ¼r diesen Spieltag! ğŸ‰

**Szenario 2: Zwischenstand + Abschluss**
- **15:00 Uhr:** Du trÃ¤gst einen Zwischenstand ein (1h nach Start, Spiel lÃ¤uft noch)
  - â†’ âš¡ **Blitz-Zwischenstand!** +25 Punkte (50% von 50)
  
- **16:00 Uhr:** Du schlieÃŸt das Spiel ab (2h nach Start, pÃ¼nktlich)
  - â†’ âœ… **Abschluss!** +25 Punkte (volle 50 Punkte - 25 bereits erhalten = 25 Punkte)

- **Gesamt:** +50 Punkte fÃ¼r dieses Match (25 + 25) ğŸ‰

---

## ğŸ¯ NÃ¤chste Schritte

1. âœ… Konzept finalisieren
2. ğŸ”§ Datenbank-Schema erstellen
3. ğŸ’» Backend-Logik implementieren (inkl. Berechtigungs-PrÃ¼fung)
4. ğŸ¨ UI-Komponenten entwickeln
5. ğŸ§ª Testing & Optimierung
6. ğŸš€ Rollout & Monitoring
7. ğŸ Sponsor-Suche fÃ¼r Preise

